<div class="orders-view">
    <search-criteria (searchClicked)="handleSearchClicked($event)"
                     (fetchClicked)="handleFetchClicked()">
    </search-criteria>
    <div class="order-list" *ngIf="orders">
        <h4 class="title">Lista zamówień</h4>
        <table mat-table [dataSource]="orders" class="mat-elevation-z8">
            <ng-container matColumnDef="index" class="column">
                <th mat-header-cell *matHeaderCellDef>L.p.</th>
                <td mat-cell *matCellDef="let i = index;let order">{{getIndex(i)}}
                    <mat-icon *ngIf="order.packed" title="Kompletne" class="packed-icon">done_all</mat-icon>
                </td>
            </ng-container>

            <ng-container matColumnDef="name" class="column name">
                <th mat-header-cell *matHeaderCellDef>Zamówienie</th>
                <td mat-cell *matCellDef="let order"> {{order.name}} </td>
            </ng-container>

            <ng-container matColumnDef="quantity" class="column quantity">
                <th mat-header-cell *matHeaderCellDef>Sztuki</th>
                <td mat-cell *matCellDef="let order"> {{order.quantity}} </td>
            </ng-container>

            <ng-container matColumnDef="orderedAt" class="column customer">
                <th mat-header-cell *matHeaderCellDef>Data zlecenia</th>
                <td mat-cell
                    *matCellDef="let order"> {{order.orderedAt  | date:'dd/MM/yyyy'}} </td>
            </ng-container>

            <ng-container matColumnDef="lastProcessedOn" class="column customer">
                <th mat-header-cell *matHeaderCellDef>Ostatnie skanowanie</th>
                <td mat-cell
                    *matCellDef="let order"> {{order.lastProcessedOn ? (order.lastProcessedOn | date:'dd/MM/yyyy') : ' - - - - - - - - - - '}} </td>
            </ng-container>

            <ng-container matColumnDef="stage" class="column">
                <th mat-header-cell *matHeaderCellDef>Etap produkcji</th>
                <td mat-cell *matCellDef="let order"> {{stageService.convertToView(order.stage)}} </td>
            </ng-container>

            <ng-container matColumnDef="customer" class="column">
                <th mat-header-cell *matHeaderCellDef>Klient</th>
                <td mat-cell *matCellDef="let order"> {{order.customer}} </td>
            </ng-container>

            <ng-container matColumnDef="route" class="column">
                <th mat-header-cell *matHeaderCellDef>Trasa</th>
                <td mat-cell *matCellDef="let order"> {{order.route}}</td>
            </ng-container>

            <ng-container matColumnDef="completed">
                <th mat-header-cell *matHeaderCellDef>Zakończone
                    <mat-checkbox color="primary"
                                  labelPosition="after"
                                  [(ngModel)]="allCompleted"
                                  name="completed"
                                  (click)="$event.stopPropagation()"
                                  (change)="allCompletedChecked($event)">
                    </mat-checkbox>
                </th>
                <td mat-cell *matCellDef="let order">
                    <mat-checkbox color="primary" labelPosition="after" [(ngModel)]="order.completed"
                                  name="completed"
                                  (click)="$event.stopPropagation()"
                                  (change)="completedChecked(order)">
                    </mat-checkbox>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="orderColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: orderColumns" (click)="handleShowDetails(row)"></tr>
        </table>
        <mat-paginator #paginator [length]="totalElements"
                       [pageSize]="size"
                       [pageSizeOptions]="sizeOptions"
                       (page)="paginationChanged($event)">
        </mat-paginator>
    </div>
</div>